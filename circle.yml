machine:
  python:
    version: 2.7.9
dependencies:
  post:
    - sudo curl -L -o /usr/bin/docker 'https://s3-external-1.amazonaws.com/circle-downloads/docker-1.7.1-circleci'; sudo chmod 0755 /usr/bin/docker; true
    - sudo service docker start
    - curl -L -o ~/bin/jq https://github.com/stedolan/jq/releases/download/jq-1.5rc1/jq-linux-x86_64-static && chmod +x ~/bin/jq
    - pip install --upgrade awscli
    - docker build --rm=false -t bellkev/ecs-demo:$CIRCLE_SHA1 . | cat
    - docker pull bellkev/nginx-base:stable | cat
test:
  post:
    - docker run --name uwsgi bellkev/ecs-demo:$CIRCLE_SHA1:
        background: true
    - docker run --name nginx -p 8000:8000 --link uwsgi:uwsgi bellkev/nginx-base:stable:
        background: true
    - sleep 3
    - curl http://localhost:8000 | grep "Hello"
    - ./test.sh single